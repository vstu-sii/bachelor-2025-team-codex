# Auto-Flashcards — Технические требования

## 1. Область проекта (Scope)

**В рамках MVP (In Scope):**

- Загрузка PDF-файлов (≤50MB) на английском и русском языках.
- OCR для сканированных PDF.
- Генерация 15–30 карточек «Вопрос–Ответ» с помощью LLM/NLP.
- Интервальные повторения по алгоритму SM-2.
- Экран «Review Today» для повторения карточек.
- Панель прогресса со статистикой (количество повторений, точность, серия).
- Редактирование и удаление карточек.
- Совместное использование колод преподавателями и студентами.

**Вне рамок MVP (Out of Scope):**

- Мобильные приложения.
- Синхронизация между устройствами без авторизации.
- Корпоративные (Enterprise) аккаунты.

---

## 2. Функциональные требования (FR)

- **FR-1. Загрузка PDF**: Пользователь может загрузить PDF-файл (≤50MB) через веб-интерфейс (Drag & Drop).
- **FR-2. Поддержка OCR**: Если файл является изображением → система выполняет OCR для извлечения текста.
- **FR-3. Генерация карточек**: Система генерирует 15–30 карточек «Вопрос–Ответ» с помощью LLM/NLP.
- **FR-4. Хранение карточек**: Карточки сохраняются в базе данных PostgreSQL и привязываются к пользователю/колоде.
- **FR-5. Редактирование карточек**: Пользователь может редактировать, удалять или архивировать карточки.
- **FR-6. Движок повторений (SM-2)**: Каждая карточка планируется с помощью алгоритма интервальных повторений (SM-2).
- **FR-7. Сессия повторений**: Пользователь может открыть список «Review Today» и оценить каждую карточку (0–5).
- **FR-8. Панель прогресса**: Система показывает статистику (количество повторений, точность, серия дней).
- **FR-9. Совместное использование колоды**: Преподаватель может поделиться колодой карточек со студентами.
- **FR-10. Аутентификация**: Простая аутентификация (Email + Пароль) + роли (Студент/Преподаватель).

---

## 3. Нефункциональные требования (NFR)

- **NFR-1. Производительность**

  - Генерация 30 карточек из PDF (до 20 страниц) должна занимать ≤ 60 секунд (P95).
  - Отображение карточки при повторении — ≤ 1.5 секунды (P95).
  - Поддержка до 5 одновременных пользователей без деградации производительности.

- **NFR-2. Доступность**

  - Доступность системы — 99.5% (рабочая среда).
  - Health-check endpoints для frontend и backend обязательны.
  - Оффлайн-режим повторений с последующей синхронизацией.

- **NFR-3. Масштабируемость**

  - Возможность горизонтального масштабирования backend и базы данных.
  - LLM и OCR выносятся в отдельные контейнеры.

- **NFR-4. Безопасность и приватность**

  - Данные пользователей хранятся в PostgreSQL с шифрованием на уровне диска.
  - PDF-файлы удаляются через 7 дней после загрузки.
  - Логи не содержат персональные данные (маскирование email/телефонов).

- **NFR-5. Стоимость**

  - Все запросы к LLM логируются в Langfuse с подсчётом стоимости.
  - Максимальная стоимость для одного пользователя ≤ 0.05$ в день (тестовая среда).

- **NFR-6. Интернационализация (i18n)**

  - Поддержка текстов на EN и RU в PDF.
  - Интерфейс MVP — EN (RU добавить позже).

- **NFR-7. Наблюдаемость**
  - Все запросы к LLM логируются в Langfuse.
  - Метрики API и БД собираются в Prometheus.
  - Дашборды в Grafana для мониторинга задержек, ошибок и стоимости.

---

## 4. Ограничения (Constraints)

- **Технологический стек**

  - Frontend: Next.js (React 18).
  - Backend: FastAPI (Python 3.11+).
  - Database: PostgreSQL 15.
  - Object Storage: MinIO/S3.
  - OCR: Tesseract OCR или эквивалент.
  - LLM Provider: OpenAI API или совместимый.
  - Monitoring: Langfuse, Prometheus, Grafana, ELK/Loki.
  - CI/CD: GitHub Actions.

- **Архитектурные принципы**

  - Микросервисная архитектура с контейнерами.
  - REST API с документацией OpenAPI (Swagger).
  - Использование Docker Compose для dev-среды.
  - Логирование всех ошибок и метрик.

- **Данные**

  - Формат: только PDF (MVP).
  - Максимальный размер файла: 50MB.
  - Поддержка языков: EN, RU.
  - Максимум карточек за сессию: 50.

- **Организационные ограничения**
  - Каждый артефакт создаётся отдельным Pull Request.
  - Основная ветка: `lab2-design-sprint`.
  - Индивидуальные ветки: `lab2-[role]-deliverables`.

---

## 5. Интерфейсы (Interfaces)

### REST API (основные endpoints)

- POST /auth/register — регистрация пользователя.
- POST /auth/login — аутентификация и получение JWT.
- POST /upload — загрузка PDF.
- GET /cards/{deck_id} — получение карточек колоды.
- POST /cards/{deck_id}/generate — генерация карточек через LLM.
- PATCH /cards/{card_id} — редактирование карточки.
- DELETE /cards/{card_id} — удаление карточки.
- GET /review/today — список карточек для повторения.
- POST /review/{card_id}/rate — оценка (0–5).
- GET /stats/dashboard — статистика пользователя.
- POST /share/deck/{deck_id} — совместное использование колоды.

### Сущности базы данных (PostgreSQL)

- **users** (id, email, password_hash, role, created_at).
- **decks** (id, user_id, title, created_at).
- **cards** (id, deck_id, question, answer, created_at).
- **reviews** (id, card_id, user_id, rating, next_review_date, created_at).
- **files** (id, user_id, file_path, status, created_at).
- **runs (LLM traces)** (id, user_id, request, response, latency_ms, cost_usd, created_at).

### Мониторинг и метрики

- Langfuse — трассировка LLM-запросов (prompt, latency, cost).
- Prometheus — метрики API и БД.
- Grafana — дашборды (latency, количество карточек, активные пользователи).
- Health Checks:
  - GET /health/api
  - GET /health/db
  - GET /health/llm

---

## 6. Критерии качества и приемки (Acceptance Criteria)

- Поддержка трёх ключевых сценариев:

  - (Upload → Generate → Review).
  - Offline Review → последующая синхронизация.
  - Edit/Delete карточки.

- Время генерации ≤ 60 секунд для 30 карточек (P95).
- Время отображения карточки ≤ 1.5 секунд (P95).
- Успешная работа с 5 параллельными пользователями.
- Все LLM-запросы логируются в Langfuse.
- CI/CD pipeline проходит без ошибок.
- Демонстрация MVP проходит Happy Path от загрузки файла до повторения карточек.
